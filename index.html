<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Top 50 Music Chart</title>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; background: #fff; }
    .btn { padding: 6px 12px; border: none; background: #2ecc71; color: white; cursor: pointer; border-radius: 4px; }
    .btn.red { background: #e74c3c; }
    .arrow { font-weight: bold; margin-left: 5px; }
    .admin-only { margin-top: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Top 50 Music Chart</h1>
  <div id="auth">
    <input type="password" id="adminPass" placeholder="Admin Password">
    <button class="btn" onclick="loginAdmin()">Admin Login</button>
    <button class="btn red hidden" onclick="logoutAdmin()" id="logoutBtn">Logout</button>
  </div>  <div>
    <h3>Submit a Song</h3>
    <input type="text" id="songTitle" placeholder="Song Title">
    <input type="text" id="songArtist" placeholder="Artist Name">
    <button class="btn" onclick="submitSong()">Submit</button>
  </div>  <div>
    <h3>Submit an Album (Top 10 Albums)</h3>
    <input type="text" id="albumTitle" placeholder="Album Title">
    <input type="text" id="albumArtist" placeholder="Artist Name">
    <button class="btn" onclick="submitAlbum()">Submit</button>
  </div>  <h2>Top 50 Songs</h2>
  <table>
    <thead>
      <tr><th>Rank</th><th>Title / Artist</th><th>Votes</th><th>Action</th></tr>
    </thead>
    <tbody id="songsTable"></tbody>
  </table>  <h2>Top 10 Albums</h2>
  <table>
    <thead>
      <tr><th>Rank</th><th>Title / Artist</th><th>Votes</th><th>Action</th></tr>
    </thead>
    <tbody id="albumsTable"></tbody>
  </table>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC2aps8GcLUodAUoI-l5wu5uh3AVhFcnIU",
      authDomain: "last-rocket-charts.firebaseapp.com",
      projectId: "last-rocket-charts",
      databaseURL: "https://last-rocket-charts-default-rtdb.firebaseio.com/",
      storageBucket: "last-rocket-charts.appspot.com",
      messagingSenderId: "216885990996",
      appId: "1:216885990996:web:d766b3862866159206ffc1",
      measurementId: "G-7MQNRZ1CF3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const userId = localStorage.getItem('userId') || crypto.randomUUID();
    localStorage.setItem('userId', userId);
    let isAdmin = false;

    function loginAdmin() {
      const input = document.getElementById('adminPass').value;
      if (input === '12345') {
        isAdmin = true;
        document.getElementById('logoutBtn').classList.remove('hidden');
        alert('Admin logged in');
      } else alert('Wrong password');
    }

    function logoutAdmin() {
      isAdmin = false;
      document.getElementById('logoutBtn').classList.add('hidden');
      alert('Logged out');
    }

    function submitSong() {
      const title = document.getElementById('songTitle').value.trim();
      const artist = document.getElementById('songArtist').value.trim();
      if (title && artist) {
        db.ref('songs').push({ title, artist, votes: 0, lastRank: 0 });
        document.getElementById('songTitle').value = '';
        document.getElementById('songArtist').value = '';
      }
    }

    function submitAlbum() {
      const title = document.getElementById('albumTitle').value.trim();
      const artist = document.getElementById('albumArtist').value.trim();
      if (title && artist) {
        db.ref('albums').push({ title, artist, votes: 0, lastRank: 0 });
        document.getElementById('albumTitle').value = '';
        document.getElementById('albumArtist').value = '';
      }
    }

    function vote(refPath, id) {
      const voteKey = `${refPath}_${id}`;
      const lastVote = localStorage.getItem(voteKey);
      const now = Date.now();
      const oneDay = 24 * 60 * 60 * 1000;
      let voteCount = JSON.parse(localStorage.getItem(voteKey + '_count')) || 0;

      if (!isAdmin) {
        if (lastVote && now - lastVote < oneDay && voteCount >= 3) {
          return alert('You reached max votes for this today. Try again tomorrow.');
        }
      }

      const ref = db.ref(`${refPath}/${id}/votes`);
      ref.transaction(current => (current || 0) + (isAdmin ? 33 : 33));

      if (!isAdmin) {
        localStorage.setItem(voteKey, now);
        localStorage.setItem(voteKey + '_count', JSON.stringify(voteCount + 1));
      }
    }

    function renderTable(data, tbodyId, path) {
      const tbody = document.getElementById(tbodyId);
      tbody.innerHTML = '';
      data.sort((a, b) => b.votes - a.votes);
      data.forEach((item, i) => {
        const change = item.lastRank - (i + 1);
        const arrow = change > 0 ? '▲' : change < 0 ? '▼' : '';
        tbody.innerHTML += `
          <tr>
            <td>${i + 1}${i < 10 ? `<span class='arrow'>${arrow}</span>` : ''}</td>
            <td>${item.title} / ${item.artist}</td>
            <td>${item.votes}</td>
            <td>
              <button class="btn" onclick="vote('${path}', '${item.id}')">Vote</button>
              ${isAdmin ? `<button class="btn red" onclick="removeItem('${path}', '${item.id}')">Delete</button>` : ''}
            </td>
          </tr>`;
      });
    }

    function removeItem(path, id) {
      db.ref(`${path}/${id}`).remove();
    }

    function fetchData(path, tbodyId, limit) {
      db.ref(path).on('value', snap => {
        const data = snap.val() || {};
        const arr = Object.keys(data).map(key => ({ id: key, ...data[key] })).slice(0, limit);
        renderTable(arr, tbodyId, path);
        arr.forEach((item, index) => {
          db.ref(`${path}/${item.id}`).update({ lastRank: index + 1 });
        });
      });
    }

    fetchData('songs', 'songsTable', 50);
    fetchData('albums', 'albumsTable', 10);
  </script></body>
</html>